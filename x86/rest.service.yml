version: "3.6"

services:
  get:
    image: mattwiater/rest-server
    networks:
      - app-entry
      - rhswarm
    deploy:
      replicas: 2
      labels:
        traefik.docker.network: app-entry
        traefik.backend: get
        traefik.backend.loadbalancer.method: wrr
        traefik.backend.maxconn.amount: 2
        traefik.backend.circuitbreaker.expression: 'NetworkErrorRatio() > 0.5'
        traefik.frontend.rule: "Method: GET;Path: /api;PathPrefixStrip:/api"
        traefik.port: 9001

  post:
    image: mattwiater/rest-server
    networks:
      - app-entry
      - rhswarm
    deploy:
      labels:
        traefik.docker.network: app-entry
        traefik.backend: post
        traefik.backend.loadbalancer.method: wrr
        traefik.frontend.rule: "Method: POST;Path: /api;PathPrefixStrip:/api"
        traefik.port: 9001

networks:
  app-entry:
    external: true
  rhswarm:
    external: true